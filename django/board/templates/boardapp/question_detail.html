{% extends 'base.html' %}
{% block contents %}
  <div class="container my-3">
    <h2 class="border-bottom py-2">
      <!-- 질문 제목 -->
      {{question.title}}
    </h2>
    <div class="card my-3">
      <div class="card-body">
        <div class="card-text" style="white:pre-line;">
          <!-- 질문 내용 -->
          {{question.content}}
        </div>
        <div class="d-flex justify-content-end">
          <div class="badge bg-secondary p-2">
            <!--글쓴이-->
            <div class="mb-2 text-start">{{question.author.username}}</div>
            <!-- 질문 작성 날짜 -->
            {{question.created_dttm}}
          </div>
        </div>
        <!-- 로그인 사용자와 글쓴이가 같다면 -->
        {% if question.author == request.user %}
          <div class="my-3">
            <a href="{% url 'question_modified' question.pk %}" class="btn btn-sm btn-outline-secondary">수정</a>
            <a href="#" class="btn btn-sm btn-outline-danger" data-url="{% url 'question_delete' question.pk %}">삭제</a>
          </div>
        {% endif %}
      </div>
    </div>
    <!-- 답변 영역 시작 -->
    <h5 class="border-bottom my-3 py-2">
      <!--답변갯수-->
      {{question.answer_set.count}}개의 답변이 있습니다.
    </h5>
    <div class="col-11">
      {% for answer in answers %}
        <div class="card my-3">
          <div class="card-body">
            <div class="card-text" style="white:pre-line;">
              <!-- 답변 내용 -->
              {{answer.content}}
            </div>
            <div class="d-flex justify-content-end">
              <div class="badge bg-secondary p-2">
                <!--글쓴이-->
                <div class="mb-2 text-start">{{answer.author.username}}</div>
                <!-- 답변 작성 날짜 -->
                {{answer.created_dttm}}
              </div>
            </div>
            {% if answer.author == request.user %}
              <div class="my-3">
                <a href="{% url 'answer_modified' answer.id %}" class="btn btn-sm btn-outline-secondary">수정</a>
                <a href="#" class="btn btn-sm btn-outline-danger" data-url="{% url 'answer_delete' answer.pk %}">삭제</a>
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
      <div class="col-12">
        <nav aria-label="Page navigation example">
          <ul class="pagination justify-content-center">
            {% if answers.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{answers.previous_page_number}}">Previous</a>
              </li>
            {% endif %}
            <li class="page-item">
              <a class="page-link" href="#">{{answers.number}}/{{answers.paginator.num_pages}}</a>
            </li>
            {% if answers.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{answers.next_page_number}}">Next</a>
              </li>
            {% endif %}
          </ul>
        </nav>
      </div>
      <!--답변 작성 form-->
      {% include 'form_errors.html' %}
      <form action="{% url 'answer_create' question.id %}" method="post">
        {% csrf_token %}
        <div class="form-group mb-3">
          <textarea name="content" id="content" rows="10" class="form-control" {% if not user.is_authenticated %} hidden="hidden" {% endif %}></textarea>
        </div>
        <button type=" submit" class="btn btn-primary" {% if not user.is_authenticated %} hidden="hidden" {% endif %}>답변 등록</button>
      </form>
    </div>
    <!--답변 내용 종료-->
  </div>
{% endblock contents %}
{% block script %}
  <script>
    // 질문 or 답변 삭제 버튼 클릭 시 confirm(정말로 삭제하시겠습니까?)
    /*
    let elements = document.querySelectorAll('.btn-outline-danger')
    elements.forEach((ele, idx) => {
      ele.addEventListener("click", (e) => {
        //confirm() : 확인을 클릭하면 data-url값 가져오기 location.href -> data-url 대입
        if (confirm('정말로 삭제하시겠습니까?')) {
          location.href = e.target.dataset.url;
        };
      })
    })
    */
    $(function () {
      $('.btn-outline-danger').on("click", function (e) {
        if (confirm('정말로 삭제하시겠습니까?')) {
          location.href = $(this).data('url');
        }
      });
    })
  </script>
{% endblock script %}
